
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PAES Command - Sistema Neural Anti-Tracking Blindado</title>
    
    <!-- Fonts optimizados sin tracking -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CIRUG√çA DE EMERGENCIA CSP v5.0 - RESTAURACI√ìN VASCULAR CR√çTICA -->
    <meta http-equiv="Content-Security-Policy" content="
      default-src 'self'; 
      script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.gpteng.co https://gptengineer.js https://*.lovable.dev https://static.cloudflareinsights.com; 
      style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; 
      font-src 'self' https://fonts.gstatic.com; 
      img-src 'self' data: blob:; 
      connect-src 'self' wss: ws: https: 
        https://api.lovable.dev 
        https://settifboilityelprvjd.supabase.co 
        https://*.supabase.co 
        https://supabase.co
        https://o4506071217143808.ingest.sentry.io
        wss://settifboilityelprvjd.supabase.co
        wss://*.supabase.co;
      frame-src 'none';
      object-src 'none';
      base-uri 'none';
      form-action 'self';
      upgrade-insecure-requests;
      block-all-mixed-content;
    ">
    
    <!-- Headers de seguridad vascular -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="no-referrer">
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
    
    <!-- PERMISSIONS POLICY BALANCEADO -->
    <meta http-equiv="Permissions-Policy" content="
      accelerometer=(), 
      autoplay=(), 
      camera=(), 
      geolocation=(), 
      gyroscope=(), 
      magnetometer=(), 
      microphone=(), 
      payment=(), 
      usb=(),
      web-share=(),
      xr-spatial-tracking=(),
      clipboard-read=(),
      clipboard-write=(),
      gamepad=(),
      speaker-selection=(),
      conversion-measurement=(),
      focus-without-user-activation=(),
      hid=(),
      idle-detection=(),
      serial=(),
      sync-xhr=(),
      trust-token-redemption=(),
      window-placement=(),
      local-fonts=()
    ">
    
    <!-- Anti-fingerprinting balanceado -->
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="googlebot" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    
    <!-- SISTEMA DE MONITOREO VASCULAR v5.0 -->
    <script>
      // Emergency CSP v5.0 - Vascular Reconstruction Protocol
      console.log('üö® CIRUG√çA DE EMERGENCIA CSP v5.0 INICIADA - Restauraci√≥n vascular cr√≠tica:', Date.now());
      
      // Monitoreo de conexi√≥n Supabase en tiempo real
      window.paesVascularMonitor = {
        supabaseConnections: 0,
        lastConnection: null,
        errors: [],
        status: 'INITIALIZING'
      };
      
      // Interceptar y monitorear todas las conexiones
      const originalFetch = window.fetch;
      window.fetch = function(...args) {
        const url = args[0];
        if (typeof url === 'string' && url.includes('supabase.co')) {
          window.paesVascularMonitor.supabaseConnections++;
          window.paesVascularMonitor.lastConnection = new Date().toISOString();
          window.paesVascularMonitor.status = 'CONNECTING';
          console.log('ü©∏ FLUJO SUPABASE DETECTADO:', url);
        }
        return originalFetch.apply(this, args)
          .then(response => {
            if (typeof url === 'string' && url.includes('supabase.co')) {
              if (response.ok) {
                window.paesVascularMonitor.status = 'CONNECTED';
                console.log('‚úÖ SUPABASE CONEXI√ìN EXITOSA:', response.status);
              } else {
                window.paesVascularMonitor.status = 'ERROR';
                window.paesVascularMonitor.errors.push({
                  url: url,
                  status: response.status,
                  timestamp: new Date().toISOString()
                });
                console.error('‚ùå SUPABASE ERROR:', response.status, url);
              }
            }
            return response;
          })
          .catch(error => {
            if (typeof url === 'string' && url.includes('supabase.co')) {
              window.paesVascularMonitor.status = 'CRITICAL_ERROR';
              window.paesVascularMonitor.errors.push({
                url: url,
                error: error.message,
                timestamp: new Date().toISOString()
              });
              console.error('üö® SUPABASE CRITICAL ERROR:', error, url);
            }
            throw error;
          });
      };
      
      // Bloquear APIs de fingerprinting (mantenido para seguridad)
      if (window.navigator && window.navigator.getBattery) {
        delete window.navigator.getBattery;
      }
      if (window.DeviceOrientationEvent) {
        window.DeviceOrientationEvent = undefined;
      }
      if (window.DeviceMotionEvent) {
        window.DeviceMotionEvent = undefined;
      }
      
      // Noise en canvas (simplificado)
      const originalToDataURL = HTMLCanvasElement.prototype.toDataURL;
      HTMLCanvasElement.prototype.toDataURL = function(...args) {
        const context = this.getContext('2d');
        if (context) {
          const imageData = context.getImageData(0, 0, 1, 1);
          if (imageData.data.length > 0) {
            imageData.data[0] = imageData.data[0] ^ (Math.random() > 0.5 ? 1 : 0);
            context.putImageData(imageData, 0, 0);
          }
        }
        return originalToDataURL.apply(this, args);
      };
      
      // Verificaci√≥n vascular cada 5 segundos
      setInterval(() => {
        console.log('ü©∏ ESTADO VASCULAR v5.0:', {
          timestamp: new Date().toISOString(),
          status: window.paesVascularMonitor.status,
          connections: window.paesVascularMonitor.supabaseConnections,
          lastConnection: window.paesVascularMonitor.lastConnection,
          errors: window.paesVascularMonitor.errors.length,
          cspVersion: '5.0-emergency'
        });
      }, 5000);
      
      // Verificaci√≥n inicial despu√©s de carga
      setTimeout(() => {
        if (window.paesVascularMonitor.supabaseConnections === 0) {
          console.warn('‚ö†Ô∏è NO HAY FLUJO SUPABASE DESPU√âS DE 3 SEGUNDOS - Posible obstrucci√≥n vascular');
          window.paesVascularMonitor.status = 'NO_FLOW';
        }
      }, 3000);
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
